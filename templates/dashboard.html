<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Windsurf Dashboard ‚Äì {{ current_view }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">üèÑ Windsurf Dashboard</div>
    <nav class="views">
      {% for v in views %}
        {% if v == current_view %}
          <span class="view active">{{ v }}</span>
        {% else %}
          <a class="view" href="/view/{{ v }}">{{ v }}</a>
        {% endif %}
      {% endfor %}
    </nav>
  </header>

  <!-- Use two-column only on compact (main); single-pane on detail -->
  <main class="{% if compact %}twocol{% else %}single{% endif %}">
    {% if compact and show_dwd %}
      <!-- LEFT: DWD only on compact (main) -->
      <section class="left">
        <div class="card card--dwd">
          <div class="card__title">DWD ‚Äì Gro√üwetterlage & Prognosen</div>
          <div class="card__content">
            <img id="dwd-rotator" class="dwd-img" alt="DWD Gro√üwetterlage" />
            <div class="muted" style="margin-top:.4rem">
              <small>Analysis 30 s, then forecasts 5 s each.</small>
            </div>
          </div>
        </div>
      </section>

      <script>
      (function () {
        const version = "{{ dwd_version }}";
        const frames = [
          { src: "/dwd/main.png?d=" + version,  duration: 30000 },
          { src: "/dwd/v036.png?d=" + version,  duration: 5000  },
          { src: "/dwd/v048.png?d=" + version,  duration: 5000  },
          { src: "/dwd/v060.png?d=" + version,  duration: 5000  },
          { src: "/dwd/v084.png?d=" + version,  duration: 5000  },
          { src: "/dwd/v108.png?d=" + version,  duration: 5000  },
        ];
        frames.forEach(f => { const im = new Image(); im.src = f.src; });
        const img = document.getElementById("dwd-rotator");
        let i = 0;
        function show() {
          img.src = frames[i].src;
          setTimeout(() => { i = (i + 1) % frames.length; show(); }, frames[i].duration);
        }
        show();
      })();
      </script>
    {% endif %}

    <!-- RIGHT (compact) or SINGLE (detail) -->
    <section class="{% if compact %}right{% else %}single-body{% endif %}">
      {% for s in spot_cards %}
        <div class="card {% if compact %}card--spot{% else %}card--map{% endif %}">
          <div class="card__title">{{ s.title }}</div>
          <div class="card__content">
            {% if s.iframe_src %}
              <iframe
                class="frame {% if compact %}spot-frame{% else %}map-embed{% endif %}"
                src="{{ s.iframe_src }}"
                loading="lazy"
                referrerpolicy="no-referrer"
              ></iframe>
              <!-- debug: {{ s.iframe_src }} -->
            {% else %}
              <div class="error">‚ö†Ô∏è Not configured correctly</div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </section>
  </main>

  <!-- Fit-to-viewport helpers (unchanged) -->
  <script>
    (function () {
      function applyFit() {
        const top = document.querySelector('.topbar')?.offsetHeight || 0;
        const foot = document.querySelector('.footer')?.offsetHeight || 0;
        const padding = 16;
        const fitH = Math.max(320, window.innerHeight - top - foot - padding);
        document.documentElement.style.setProperty('--fit-h', fitH + 'px');
      }
      window.addEventListener('resize', applyFit);
      window.addEventListener('orientationchange', applyFit);
      function setVhUnit() {
        document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px');
      }
      window.addEventListener('resize', setVhUnit);
      setVhUnit();
      applyFit();
    })();
  </script>

  <footer class="footer">
    <div>
      <small>Windy & Windfinder content ¬© their providers.</small>
    </div>
  </footer>
</body>
</html>
